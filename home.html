<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>TheBookMark</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900">
  <script>
    // Redirect to login if not authenticated (run as early as possible)
    if (!localStorage.getItem('isLoggedIn')) {
      window.location.replace('index.html');
    }
  </script>
  <script>
    // Extra protection: block rendering until authentication is checked
    (function() {
      if (!localStorage.getItem('isLoggedIn')) {
        document.documentElement.style.display = 'none';
        window.location.replace('index.html');
      }
    })();
  </script>

  <!--Header-->
  <header class="bg-white shadow-sm sticky top-0 z-50">
    <div class="container mx-auto flex justify-between items-center p-4">
      <a href="home.html" class="text-2xl font-bold text-black-900 flex items-center hover:text-blue-600" style="cursor:pointer;">
        <img src="https://img.icons8.com/ios-filled/50/000000/book.png" alt="Logo" class="h-8 w-8 mr-2">TheBookMark
      </a>
      <nav class="space-x-6 text-sm font-medium relative">
        <a href="home.html" class="hover:text-blue-600">Home</a>
        <a href="buy.html" class="hover:text-blue-600">Buy</a>
        <a href="sell-exchange.html" class="hover:text-blue-600">Sell or Exchange</a>
        <div class="inline-block relative" id="profile-menu-container">
          <a href="#" class="hover:text-blue-600 cursor-pointer" id="profile-menu-btn">Profile</a>
          <div id="profile-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white border border-gray-200 rounded-lg shadow-lg z-50 text-left">
            <a href="profile.html" class="block px-4 py-2 hover:bg-blue-50">Your Profile</a>
            <a href="favorites.html" class="block px-4 py-2 hover:bg-blue-50">Favorite Books</a>
            <a href="index.html" class="block px-4 py-2 text-red-600 hover:bg-red-50">Sign Out</a>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <!--Hero Section-->
  <section class="text-center py-16 px-4">
    <h1 class="text-4xl font-bold mb-6">Find, Sell, or Exchange Your Books Easily</h1>
    <div class="max-w-xl mx-auto">
      <div class="relative">
        <input type="text" id="homeSearchInput" placeholder="Search by Title, Author or Genre" 
          class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-400 shadow-sm bg-white">
        <svg class="w-5 h-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
        </svg>
      </div>
    </div>
  </section>

  <!--Featured Books Carousel-->
  <section class="max-w-6xl mx-auto px-4">
    <h2 class="text-2xl font-bold mb-8">Featured Books</h2>
    <div class="relative">
      <button id="carousel-left" class="absolute left-0 top-1/2 -translate-y-1/2 bg-white border rounded-full shadow p-2 z-10 hover:bg-blue-100 transition">
        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
        </svg>
      </button>
      <div id="carousel-track" class="overflow-hidden">
        <div id="carousel-container" class="flex transition-transform duration-500" style="will-change: transform;">
          <!-- Books will be loaded dynamically -->
        </div>
      </div>
      <button id="carousel-right" class="absolute right-0 top-1/2 -translate-y-1/2 bg-white border rounded-full shadow p-2 z-10 hover:bg-blue-100 transition">
        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
        </svg>
      </button>
    </div>
  </section>

  <!--Call to Action-->
  <section class="mt-16 text-center">
    <div onclick="window.location.href='buy.html?for_what=Exchange'" class="bg-white mx-auto max-w-2xl py-6 px-4 rounded-xl shadow-sm hover:shadow-md cursor-pointer transition-all hover:bg-blue-50">
      <p class="font-semibold text-lg">Want to swap books? Find your perfect match!</p>
    </div>
  </section>

  <!--Footer-->
  <footer class="mt-auto py-8 border-t text-center text-sm text-gray-500 bg-white">
    <div class="flex flex-col md:flex-row justify-center items-center gap-4">
      <a href="#" onclick="showAboutModal(event)" class="hover:text-blue-600">About Us</a>
      <a href="mailto:baver.koca00@gmail.com" class="hover:text-blue-600">Contact</a>
    </div>
    <div class="flex justify-center gap-6 mt-4">
      <a href="https://www.linkedin.com/in/baver-koca" target="_blank" rel="noopener">
        <img src="https://images.rawpixel.com/image_png_800/czNmcy1wcml2YXRlL3Jhd3BpeGVsX2ltYWdlcy93ZWJzaXRlX2NvbnRlbnQvbHIvdjk4Mi1kMi0xMC5wbmc.png" alt="LinkedIn" class="h-6">
      </a>
      <a href="https://github.com/BaverKoca" target="_blank" rel="noopener">
        <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/github/github-original.svg" alt="GitHub" class="h-6">
      </a>
    </div>
    <div class="mt-4 text-xs text-gray-400">&copy; 2025 TheBookMark. All rights reserved.</div>
  </footer>

  <!-- About Us Modal -->
  <div id="about-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-2xl max-w-2xl w-full p-8 shadow-2xl relative border-2 border-blue-200 animate-fade-in overflow-y-auto max-h-[90vh]">
      <button id="close-about-modal" class="absolute top-2 right-2 text-gray-400 hover:text-blue-600 text-3xl font-bold transition">&times;</button>
      <div class="flex flex-col items-center mb-4">
        <img src="https://img.icons8.com/ios-filled/50/000000/book.png" alt="Logo" class="h-12 w-12 mb-2">
        <h2 class="text-3xl font-extrabold text-blue-700 mb-2">About Us</h2>
      </div>
      <div class="text-gray-700 text-base leading-relaxed whitespace-pre-line mb-4 px-2 md:px-6" style="font-size:1.08rem;">
        We are a team of three third-year Computer Engineering students at Eastern Mediterranean University. Throughout our university journey, we encountered a common problem that many students face — accessing course books easily and affordably. To address this, we developed a platform that simplifies the buying, selling, and exchanging of second-hand textbooks.

        Every semester brings new books and new expenses. Our goal is to reduce the financial burden on students by enabling them to buy and sell books at reasonable prices, or even exchange them with others, promoting a culture of sharing and sustainability on campus.

        With a clean design, user-friendly interface, and secure infrastructure, our platform aims to turn textbook transactions into more than just trades — we want to foster a sense of student community and collaboration.

        This project is more than just a technical exercise for us; it's a real-world solution to a real student problem. We're committed to continuously improving our platform based on user feedback and evolving needs.
      </div>
      <div class="mb-2 px-2 md:px-6">
        <h3 class="text-lg font-bold text-blue-600 mb-1">Our Team</h3>
        <ul class="list-disc list-inside text-gray-800">
          <li><span class="font-semibold">Baver Koca</span> – Team Leader</li>
          <li><span class="font-semibold">Fehmi Alper Demir</span> – Web Developer</li>
          <li><span class="font-semibold">Sami Anıl Akbaş</span> – Tester</li>
        </ul>
      </div>
      <div class="text-gray-600 text-sm mt-4 text-center px-2 md:px-6">
        Feel free to reach out to us with your feedback, questions, or if you'd like to contribute.<br>We're always open to collaboration!
      </div>
    </div>
  </div>
  <style>
    @keyframes fade-in {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    .animate-fade-in {
      animation: fade-in 0.3s ease;
    }
  </style>
  <script>
    // Load featured books from database
    async function loadFeaturedBooks() {
      try {
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        if (!currentUser || !currentUser.id) {
          window.location.href = 'index.html';
          return;
        }

        // Fetch all available books directly from the backend (same as buy.html)
        const response = await fetch('http://localhost:3001/api/books');
        let books = await response.json();
        books = books.filter(b => b.status === 'available');

        const carouselContainer = document.getElementById('carousel-container');
        
        if (books.length === 0) {
          carouselContainer.innerHTML = '<p class="text-center text-gray-500 w-full">No books available at the moment.</p>';
          return;
        }

        // Get up to 10 random books
        let featuredBooks = [];
        if (books.length > 10) {
          // Shuffle and pick 10
          for (let i = books.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [books[i], books[j]] = [books[j], books[i]];
          }
          featuredBooks = books.slice(0, 10);
        } else {
          featuredBooks = books;
        }

        // Render 10 slots, fill with books or empty placeholders
        carouselContainer.innerHTML = Array.from({length: 10}).map((_, idx) => {
          const b = featuredBooks[idx];
          if (!b) {
            return `<div class='text-center min-w-[250px] max-w-xs mx-2 opacity-30 bg-gray-100 rounded-lg h-72 flex items-center justify-center'>
              <span class='text-gray-400'>Empty</span>
            </div>`;
          }
          return `
            <div class='text-center min-w-[250px] max-w-xs mx-2'>
              <img src='http://localhost:3001${b.picture_url}' alt='${b.title}' class='mx-auto mb-4 h-48 object-contain bg-blue-50 rounded-lg'>
              <h3 class='font-semibold'>${b.title}</h3>
              <p class='text-sm text-gray-600'>${b.author}</p>
              ${b.for_what === 'Sell' 
                ? `<p class='mt-2 font-semibold'>$${b.price.toFixed(2)}</p>`
                : `<p class='mt-2 font-semibold text-green-600'>Available for Exchange</p>`
              }
            </div>
          `;
        }).join('');

        // Initialize carousel
        let currentPosition = 0;
        const itemWidth = 250 + 16; // width + margin
        const maxPosition = -(featuredBooks.length * itemWidth - carouselContainer.parentElement.offsetWidth);

        document.getElementById('carousel-left').addEventListener('click', () => {
          currentPosition = Math.min(currentPosition + itemWidth * 3, 0);
          carouselContainer.style.transform = `translateX(${currentPosition}px)`;
        });

        document.getElementById('carousel-right').addEventListener('click', () => {
          currentPosition = Math.max(currentPosition - itemWidth * 3, maxPosition);
          carouselContainer.style.transform = `translateX(${currentPosition}px)`;
        });

      } catch (error) {
        console.error('Error loading featured books:', error);
        document.getElementById('carousel-container').innerHTML = 
          '<p class="text-center text-red-500 w-full">Error loading books. Please try again later.</p>';
      }
    }

    // Load featured books when page loads
    document.addEventListener('DOMContentLoaded', loadFeaturedBooks);

    // Home page search functionality
    document.getElementById('homeSearchInput').addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        const searchQuery = this.value.trim();
        if (searchQuery) {
          window.location.href = `buy.html?search=${encodeURIComponent(searchQuery)}`;
        }
      }
    });

    // Profile dropdown functionality
    const profileBtn = document.getElementById('profile-menu-btn');
    const profileDropdown = document.getElementById('profile-dropdown');
    const profileMenuContainer = document.getElementById('profile-menu-container');
    let dropdownTimeout;

    function showDropdown() {
      clearTimeout(dropdownTimeout);
      profileDropdown.classList.remove('hidden');
    }
    function hideDropdown() {
      dropdownTimeout = setTimeout(() => {
        profileDropdown.classList.add('hidden');
      }, 150);
    }

    profileBtn.addEventListener('mouseenter', showDropdown);
    profileMenuContainer.addEventListener('mouseleave', hideDropdown);
    profileMenuContainer.addEventListener('mouseenter', showDropdown);
    profileBtn.addEventListener('click', function(e) {
      e.preventDefault();
      showDropdown();
    });
    profileDropdown.addEventListener('mouseenter', showDropdown);
    profileDropdown.addEventListener('mouseleave', hideDropdown);
    document.addEventListener('click', function(e) {
      if (!profileMenuContainer.contains(e.target)) {
        profileDropdown.classList.add('hidden');
      }
    });

    // About Us Modal functionality
    const aboutModal = document.getElementById('about-modal');
    const closeAboutModal = document.getElementById('close-about-modal');

    function showAboutModal(event) {
      event.preventDefault();
      aboutModal.classList.remove('hidden');
      document.body.style.overflow = 'hidden'; // Prevent scrolling when modal is open
    }

    function hideAboutModal() {
      aboutModal.classList.add('hidden');
      document.body.style.overflow = ''; // Restore scrolling
    }

    closeAboutModal.addEventListener('click', hideAboutModal);

    // Close modal when clicking outside
    aboutModal.addEventListener('click', (e) => {
      if (e.target === aboutModal) {
        hideAboutModal();
      }
    });

    // Close modal with Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !aboutModal.classList.contains('hidden')) {
        hideAboutModal();
      }
    });
  </script>

</body>
</html>